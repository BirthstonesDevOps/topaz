<p-toast></p-toast>

<div *ngIf="loading" class="card">
    <div class="text-center">
        <p-progressSpinner [style]="{ width: '50px', height: '50px' }" strokeWidth="6" styleClass="custom-spinner"> </p-progressSpinner>
        <div class="mt-3 text-primary font-bold text-lg">Cargando...</div>
    </div>
</div>

<div *ngIf="!loading && providers.length === 0" class="card">
    <div class="text-center">
        <i class="pi pi-users text-6xl text-gray-400 mb-4"></i>
        <div class="text-gray-600 font-bold text-xl mb-2">No hay proveedores</div>
        <div class="text-gray-500 mb-4">No se han registrado proveedores aún. Comienza agregando el primer proveedor.</div>
        <p-button label="Agregar proveedor" icon="pi pi-plus" severity="primary" (onClick)="openNew()"></p-button>
    </div>
</div>

<p-toolbar styleClass="mb-6" *ngIf="!loading && providers.length > 0">
    <ng-template #start>
        <p-button label="Nuevo" icon="pi pi-plus" severity="secondary" class="mr-2" (onClick)="openNew()" />
    </ng-template>

    <ng-template #end>
        <p-button label="Exportar" icon="pi pi-upload" severity="secondary" (onClick)="exportCSV()" />
    </ng-template>
</p-toolbar>

<div class="card" *ngIf="!loading && providers.length > 0">
    <div class="flex mb-4 justify-between w-full">
        <div class="font-semibold text-xl">Gestionar Proveedores</div>
        <p-button icon="pi pi-chevron-up" severity="secondary" (onClick)="collapseAll()" text />
    </div>
    <p-accordion [multiple]="true" value="[0]" #accordion>
        <p-accordion-panel *ngFor="let provider of providers" [value]="provider.id!">
            <p-accordion-header>
                <div class="flex justify-between items-center w-full mr-4">
                    <span>{{ provider.name }}</span>
                    <div>
                        <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true" (click)="editProvider()" />
                        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="deleteProvider()" />
                    </div>
                </div>
            </p-accordion-header>
            <p-accordion-content>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Basic Information -->
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <i class="pi pi-map-marker text-primary mr-3 text-lg"></i>
                            <div>
                                <div class="font-bold text-sm text-gray-600">Dirección</div>
                                <div>{{ provider.address || 'No especificada' }}</div>
                            </div>
                        </div>

                        <div class="flex items-center">
                            <i class="pi pi-envelope text-primary mr-3 text-lg"></i>
                            <div>
                                <div class="font-bold text-sm text-gray-600">Email</div>
                                <div>{{ provider.email || 'No especificado' }}</div>
                            </div>
                        </div>

                        <div class="flex items-center">
                            <i class="pi pi-calendar text-primary mr-3 text-lg"></i>
                            <div>
                                <div class="font-bold text-sm text-gray-600">Fecha de Creación</div>
                                <div>{{ provider.createdAt | date: 'short' }}</div>
                            </div>
                        </div>

                        <div class="flex items-center" *ngIf="provider.updatedAt">
                            <i class="pi pi-clock text-primary mr-3 text-lg"></i>
                            <div>
                                <div class="font-bold text-sm text-gray-600">Última Actualización</div>
                                <div>{{ provider.updatedAt | date: 'short' }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Phones and Notes -->
                    <div class="space-y-6">
                        <!-- Phones -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <div class="font-bold text-sm text-gray-600">Teléfonos</div>
                                <p-button icon="pi pi-plus" label="Agregar Teléfono" severity="secondary" [outlined]="true" size="small" (onClick)="addPhone(provider)" />
                            </div>
                            <div *ngIf="provider.phones && provider.phones.length > 0" class="space-y-2">
                                <div *ngFor="let phone of provider.phones" class="flex items-center">
                                    <i class="pi pi-phone text-primary mr-3 text-lg"></i>
                                    <span>{{ phone.phoneNumber }}</span>
                                </div>
                            </div>
                            <div *ngIf="!provider.phones || provider.phones.length === 0" class="text-gray-500 text-sm italic">No hay teléfonos registrados</div>
                        </div>

                        <!-- Notes -->
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <div class="font-bold text-sm text-gray-600">Notas</div>
                                <p-button icon="pi pi-plus" label="Agregar Nota" severity="secondary" [outlined]="true" size="small" (onClick)="addNote(provider)" />
                            </div>
                            <div *ngIf="provider.notes && provider.notes.length > 0" class="space-y-3">
                                <div *ngFor="let note of provider.notes" class="p-3 bg-gray-50 rounded">
                                    <div class="font-bold text-sm mb-2">{{ note.title || 'Sin título' }}</div>
                                    <div class="text-sm">{{ note.content }}</div>
                                    <div class="text-xs text-gray-500 mt-2">{{ note.createdAt | date: 'short' }}</div>
                                </div>
                            </div>
                            <div *ngIf="!provider.notes || provider.notes.length === 0" class="text-gray-500 text-sm italic">No hay notas registradas</div>
                        </div>
                    </div>
                </div>
            </p-accordion-content>
        </p-accordion-panel>
    </p-accordion>
</div>

<p-dialog header="Dialog" [(visible)]="addProviderDialog" [breakpoints]="{ '960px': '75vw' }" [style]="{ width: '30vw' }" [modal]="true">
    <ng-template #content>
        <div class="flex flex-col gap-6">

        </div>
    </ng-template>

    <ng-template #footer>

    </ng-template>
</p-dialog>
